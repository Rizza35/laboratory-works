// 4.6 В символьной строке удалить предпоследнее слово.

#include <stdio.h> 
#include <string.h> 
#include <ctype.h> // Для проверки на пробелы

#define MAXLINE 1000 // Определяем константу для максимальной длины строки

// Объявляем функцию для обработки строки
void process_line(char buffer[]);

int main(void) {
    char line[MAXLINE]; // Объявляем массив символов (строку) для хранения введенной строки
    
    printf("Введите строку: "); // Выводим приглашение для ввода строки
    fgets(line, MAXLINE, stdin); // Читаем строку из стандартного ввода (клавиатуры)

    process_line(line); // Вызываем функцию для обработки строки
    
    printf("Результат: %s", line); // Выводим измененную строку на экран
    
    return 0; // Возвращаем 0, указывая на успешное завершение программы
}

// Функция для обработки строки
void process_line(char buffer[]) {
    int word_count = 0; // Инициализируем счетчик слов
    int word_start[MAXLINE]; // Массив для хранения индексов начала каждого слова
    int word_end[MAXLINE]; // Массив для хранения индексов конца каждого слова
    int i, j, k, len; // Объявляем переменные-счетчики и переменную для длины строки
    
    len = strlen(buffer); // Вычисляем длину строки

    // Находим начало и конец каждого слова
    int in_word = 0; // Флаг, показывающий, находимся ли мы внутри слова
    for (i = 0; i < len; i++) { // Перебираем каждый символ в строке
        // Если текущий символ не является пробельным символом и не является концом строки
        if (!isspace(buffer[i]) && buffer[i] != '\0') {
            // Если мы не находимся внутри слова
            if (!in_word) {
                word_start[word_count] = i; // Записываем индекс начала слова
                in_word = 1; // Устанавливаем флаг, что мы внутри слова
            }
        } else {
            // Если мы находились внутри слова, но встретили пробельный символ
            if (in_word) {
                word_end[word_count] = i; // Записываем индекс конца слова
                word_count++; // Увеличиваем счетчик слов
                in_word = 0; // Устанавливаем флаг, что мы вне слова
            }
        }
    }
    // Если мы закончили строку, находясь внутри слова
    if (in_word) {
        word_end[word_count] = i; // Записываем индекс конца слова
        word_count++; // Увеличиваем счетчик слов
    }
    
    // Если есть как минимум 2 слова, удаляем предпоследнее
    if (word_count >= 2) {
        int delete_start = word_start[word_count - 2]; // Индекс начала удаляемого слова
        int delete_end = word_end[word_count - 2]; // Индекс конца удаляемого слова
        
        // Сдвигаем оставшуюся часть строки влево, чтобы удалить слово
        for (i = delete_end, j = delete_start; i < len; i++, j++) {
            buffer[j] = buffer[i]; // Перемещаем символы
        }
        buffer[j] = '\0'; // Завершаем строку
    }

    // Удаляем лишние пробелы
    len = strlen(buffer); // Получаем длину строки после удаления слова
    int write_index = 0; // Индекс для записи в новую строку без лишних пробелов
    int space_found = 0; // Флаг, указывающий, был ли найден пробел

    for (i = 0; i < len; i++) { // Перебираем каждый символ в строке
        // Если текущий символ не пробельный
        if (!isspace(buffer[i])) {
            // Если ранее был найден пробел и это не начало строки
            if (space_found && write_index > 0) {
                buffer[write_index++] = ' '; // Добавляем один пробел
            }
            space_found = 0; // Сбрасываем флаг пробела
            buffer[write_index++] = buffer[i]; // Копируем текущий символ
        } else {
            space_found = 1; // Устанавливаем флаг, что найден пробел
        }
    }

    // Если в конце строки остался пробел, удаляем его
    if (write_index > 0 && isspace(buffer[write_index - 1])) {
        write_index--; // Уменьшаем индекс записи
    }

    buffer[write_index] = '\0'; // Завершаем строку
}